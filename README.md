# Книжный помощник API на FastAPI

## Описание
API на FastAPI для получения ответов на вопросы по книге с использованием RAG (Retrieval Augmented Generation).
Система использует LangChain и OpenAI для обработки документа PDF и предоставления ответов на основе контекста книги.

## Требования
- Python 3.8 или выше
- OpenAI API ключ
- PDF-документ книги

## Установка

1. Клонируйте репозиторий:
```bash
git clone [репозиторий]
cd [папка-репозитория]/book_rag
```

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Создайте файл `.env` в корневой директории с вашим API ключом OpenAI:
```
OPENAI_API_KEY=ваш_ключ_openai
```

4. Поместите файл книги `book.pdf` в директорию проекта или укажите путь к нему при инициализации.

## Запуск API сервера

```bash
python api.py
```

Сервер будет запущен по адресу `http://0.0.0.0:8000`.

## Использование клиента для тестирования API

Для удобства тестирования предоставляется консольный клиент:

```bash
# Проверка статуса API
python client.py status

# Загрузка новой книги
python client.py upload путь_к_файлу.pdf

# Задать один вопрос
python client.py ask "Ваш вопрос о книге"

# Интерактивный режим для задания вопросов
python client.py interactive

# Использование другого URL API сервера
python client.py --url http://другой-адрес:порт status
```

## Использование API

### Проверка работоспособности
```
GET /health
```
Возвращает статус системы.

### Загрузка новой книги
```
POST /upload
```
Позволяет загрузить новый PDF-файл книги и реинициализировать систему.

Тип запроса: `multipart/form-data`
Поле: `file` (PDF-файл)

Пример ответа:
```json
{
    "status": "processing",
    "message": "Файл успешно загружен. Началась инициализация системы."
}
```

### Задать вопрос по книге
```
POST /ask
```

Тело запроса:
```json
{
    "question": "Ваш вопрос о книге"
}
```

Пример ответа:
```json
{
    "answer": "Ответ на ваш вопрос на основе содержания книги..."
}
```

## Документация API
После запуска API документация доступна по адресу:
- Swagger UI: `http://localhost:8000/docs`
- ReDoc: `http://localhost:8000/redoc`

## Особенности
- Векторизация и создание эмбеддингов производится один раз при запуске сервера
- Используется гибридный поиск для повышения точности ответов
- Реализована иерархическая система чанкинга документа

## Структура проекта
- `api.py` - FastAPI сервер
- `main.py` - Основной класс BookRAG для обработки PDF и ответов на вопросы
- `requirements.txt` - Зависимости проекта
- `.env` - Файл с переменными окружения (необходимо создать)